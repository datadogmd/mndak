---
title: "mndak zip codes"
author: "MaDuSa"
date: "2026-01-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r gemini output, echo=FALSE}

library(tigris)
library(sf)
library(dplyr)
library(leaflet)
library(readODS)

# 1. Download ZCTAs for the specific states (using their prefixes)
# MN (55, 56), ND (58), SD (57), WI (53, 54)
prefixes <- c("55", "56", "58", "57", "53", "54")
midwest_zips <- zctas(cb = TRUE, starts_with = prefixes, year = 2020, progress_bar = FALSE)

# 2. Extract the center points (Centroids)
# This converts the area polygons into single points
centroids <- st_centroid(midwest_zips)

# 3. View as a simple data frame (ZIP, Lat, Long)
final_list <- centroids %>%
  mutate(lat = st_coordinates(.)[,2],
         lon = st_coordinates(.)[,1]) %>%
  st_drop_geometry() %>%
  select(ZCTA5CE20, lat, lon)

# head(final_list)

```



```{r user data map, echo=FALSE}

# 1. Load your local data
# Ensure the file is in your current working directory
# user_data <- read.csv("mndak_zip.csv",
#                       colClasses = c("zipcode" = "character"),
#                       stringsAsFactors = FALSE)


user_data <- read_ods("mndak zip codes.ods", sheet = 1, col_types = "cccc")
user_data$tga26 <- toupper(user_data$tga26)
# 2. Join your data with the coordinate list (final_list from previous step)
# This assumes 'final_list' has columns: ZCTA5CE20, lat, lon
map_data <- user_data %>%
  inner_join(final_list, by = c("zipcode" = "ZCTA5CE20"))

# 3. Create a color palette based on your requirements
# YES = Green, MAYBE = Blue, NO = Red
pal <- colorFactor(
  palette = c("blue", "red", "green"), 
  levels = c("MAYBE", "NO", "YES"),
  na.color = "transparent" # This makes NA values invisible
)


# Create a list of labels with HTML formatting
# <b> is for bold, <br/> is for a new line
labels <- sprintf(
  "Name: %s<br/>ZIP: %s<br/>Status: %s<br/>",
  map_data$firstname,
  map_data$zipcode, 
  map_data$tga26
) %>% lapply(htmltools::HTML)



# 4. Build the Leaflet Map
leaflet(map_data) %>%
  addTiles() %>%  # Background map
  addCircleMarkers(
    lng = ~lon, 
    lat = ~lat,
    color = ~pal(tga26),  # Apply the color logic
    radius = 5,
    fillOpacity = 0.8,
    stroke = FALSE,
    label = labels, # Use the HTML labels made earlier
    labelOptions = labelOptions(
      style = list(
        "font-weight" = "normal", 
        "padding" = "8px",          # Extra space like a popup
        "border-color" = "rgba(0,0,0,0.5)"
      ),
      textsize = "14px",
      direction = "auto"
    )
  ) %>%
  addLegend(
    pal = pal, 
    values = ~tga26, 
    title = "Status",
    position = "bottomright"
  )


```


