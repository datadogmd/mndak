---
title: "mndak zip codes"
author: "MaDuSa"
date: "2026-01-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r gemini output}

library(tigris)
library(sf)
library(dplyr)
library(leaflet)

# 1. Download ZCTAs for the specific states (using their prefixes)
# MN (55, 56), ND (58), SD (57), WI (53, 54)
prefixes <- c("55", "56", "58", "57", "53", "54")
midwest_zips <- zctas(cb = TRUE, starts_with = prefixes, year = 2020)

# 2. Extract the center points (Centroids)
# This converts the area polygons into single points
centroids <- st_centroid(midwest_zips)

# 3. View as a simple data frame (ZIP, Lat, Long)
final_list <- centroids %>%
  mutate(lat = st_coordinates(.)[,2],
         lon = st_coordinates(.)[,1]) %>%
  st_drop_geometry() %>%
  select(ZCTA5CE20, lat, lon)

head(final_list)

```



```{r user data}

# 1. Load your local data
# Ensure the file is in your current working directory
user_data <- read.csv("mndak_zip.csv",
                      colClasses = c("zipcode" = "character"),
                      stringsAsFactors = FALSE)

# 2. Join your data with the coordinate list (final_list from previous step)
# This assumes 'final_list' has columns: ZCTA5CE20, lat, lon
map_data <- user_data %>%
  inner_join(final_list, by = c("zipcode" = "ZCTA5CE20"))

# 3. Create a color palette based on your requirements
# YES = Green, MAYBE = Blue, NO = Red
pal <- colorFactor(
  palette = c("blue", "red", "green"), 
  levels = c("MAYBE", "NO", "YES")
)

# 4. Build the Leaflet Map
leaflet(map_data) %>%
  addTiles() %>%  # Background map
  addCircleMarkers(
    lng = ~lon, 
    lat = ~lat,
    color = ~pal(status),  # Apply the color logic
    radius = 5,
    fillOpacity = 0.8,
    stroke = FALSE,
    popup = ~paste0("<b>ZIP: </b>", zipcode, "<br><b>Status: </b>", status)
  ) %>%
  addLegend(
    pal = pal, 
    values = ~status, 
    title = "Status",
    position = "bottomright"
  )


```


```{r leaflet map}

# Create the map
leaflet(final_list) %>%
  addTiles() %>%  # Adds the default OpenStreetMap tiles
  addCircleMarkers(
    lng = ~lon, 
    lat = ~lat, 
    radius = 3, 
    color = "blue",
    stroke = FALSE, 
    fillOpacity = 0.5,
    popup = ~ZCTA5CE20  # Shows the ZIP code when you click a point
  )



```


```{r google map}

# 1. Register your API key (get one at console.cloud.google.com)
# register_google(key = "YOUR_API_KEY_HERE")

# 2. Get the base map (centered on the Midwest)
midwest_map <- get_googlemap(center = c(lon = -95, lat = 45), zoom = 5, maptype = "terrain")

# 3. Plot the points using ggplot2 syntax
ggmap(midwest_map) +
  geom_point(data = final_list, aes(x = lon, y = lat), color = "red", size = 0.5, alpha = 0.4) +
  labs(title = "ZCTA Centroids: MN, ND, SD, WI")


```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
